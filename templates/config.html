<!-- Esempio per OpenAI, da replicare per gli altri provider -->
<div class="provider-section">
  <div class="provider-header">
    <div class="provider-icon">ðŸ¤–</div>
    <div class="provider-info">
      <h3>OpenAI</h3>
      <p>Modelli GPT per compiti generali e creativi</p>
    </div>
  </div>
  <div class="api-key-section">
    <h4>Chiave API OpenAI</h4>
    <div class="api-key-form">
      <input type="password" id="openai-key" class="api-key-input" placeholder="Inserisci la tua chiave API OpenAI">
      <button class="btn btn-primary" onclick="setApiKey('openai')">Salva</button>
      <button class="btn btn-secondary" onclick="testConnection('openai')">Test</button>
      {% if missing_keys.openai %}
      <a href="https://platform.openai.com/api-keys" target="_blank" style="margin-left:10px;color:#667eea;">Ottieni una chiave</a>
      {% endif %}
    </div>
    <div id="openai-test-result" class="test-result" style="display: none;"></div>
  </div>
  {% if not missing_keys.openai %}
  <div style="margin:20px 0;">
    <label for="openai-model-select"><b>Modello OpenAI:</b></label>
    <select id="openai-model-select" class="param-input" style="width:300px;"></select>
    <button class="btn btn-primary" onclick="saveSelectedModel('openai')">Seleziona</button>
  </div>
  {% endif %}
</div>
<!-- ... ripeti per Anthropic, Google, Locale ... -->
<!-- Prompt di sistema -->
<div class="provider-section">
  <h3>Prompt di sistema</h3>
  <div class="api-key-section">
    <textarea id="system-prompt" class="param-input" style="width:100%;min-height:120px;"></textarea>
    <button class="btn btn-primary" onclick="saveSystemPrompt()">Salva Prompt</button>
    <span id="system-prompt-status" style="margin-left:10px;"></span>
  </div>
</div>
<script>
function populateModelSelect(provider) {
  fetch('/api/list_models', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ provider: provider })
  })
  .then(response => response.json())
  .then(data => {
    const select = document.getElementById(provider + '-model-select');
    if (!select) return;
    select.innerHTML = '';
    if (data.status === 'success' && data.models.length > 0) {
      data.models.forEach(model => {
        const option = document.createElement('option');
        option.value = model;
        option.textContent = model;
        select.appendChild(option);
      });
    } else {
      const option = document.createElement('option');
      option.value = '';
      option.textContent = 'Nessun modello disponibile';
      select.appendChild(option);
    }
  });
}
function saveSelectedModel(provider) {
  const select = document.getElementById(provider + '-model-select');
  const modelId = select.value;
  if (!modelId) return alert('Seleziona un modello valido');
  fetch('/api/set_model', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ model_id: modelId })
  })
  .then(response => response.json())
  .then(data => {
    if (data.status === 'success') {
      alert('Modello impostato con successo!');
      loadConfig();
    } else {
      alert('Errore: ' + data.message);
    }
  });
}
function loadSystemPrompt() {
  fetch('/api/get_system_prompt')
    .then(r => r.json())
    .then(data => {
      if(data.status === 'success') {
        document.getElementById('system-prompt').value = data.prompt;
      }
    });
}
function saveSystemPrompt() {
  const prompt = document.getElementById('system-prompt').value.trim();
  fetch('/api/set_system_prompt', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt })
  })
  .then(r => r.json())
  .then(data => {
    const status = document.getElementById('system-prompt-status');
    if(data.status === 'success') {
      status.textContent = 'Prompt salvato!';
      status.style.color = 'green';
    } else {
      status.textContent = 'Errore: ' + data.message;
      status.style.color = 'red';
    }
    setTimeout(() => status.textContent = '', 2000);
  });
}
// Popola i menu modelli al caricamento
['openai','anthropic','google','local'].forEach(populateModelSelect);
// Carica il prompt al caricamento pagina
loadSystemPrompt();
// Aggiorna endpoint locale al cambio backend
const backendSelect = document.getElementById('local-backend-select');
if(backendSelect) {
  backendSelect.addEventListener('change', function() {
    fetch('/api/default_endpoint', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ backend: this.value })
    })
    .then(r => r.json())
    .then(data => {
      if(data.status === 'success') {
        document.getElementById('local-endpoint-input').value = data.endpoint;
      }
    });
  });
}
</script> 